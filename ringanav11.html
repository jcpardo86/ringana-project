<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Ventas</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .large-emoji { font-size: 2rem; }
        .scrollable {
            max-height: 400px; /* Limita la altura */
            overflow-y: auto; /* Habilita el desplazamiento vertical */
            overflow-x: auto; /* Oculta el desplazamiento horizontal para evitar movimientos laterales */
            width: 100%; /* Mantiene el ancho completo */
            border: 1px solid #ddd; /* Opcional: estilo del borde */
            padding: 0.5rem; /* Opcional: espacio interno */
            box-sizing: border-box; /* Asegura el ajuste correcto de las dimensiones */
        }
        .container { max-width: 70%; margin: 0 auto; }
        .icon-button { background: none; border: none; cursor: pointer; padding: 0; }
        .hidden { display: none; }
        .toggle-button, .add-button { background-color: #3182ce; color: white; padding: 0.5rem 1rem; border-radius: 0.375rem; margin-top: 0.5rem; }
        .add-button { margin-left: 0.5rem; background-color: #38B2AC; }
        .button-container { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 0.5rem; }
        .icon { font-size: 1.25rem; }
        #barraProgreso {
            position: relative; /* Posiciona el texto dentro de la barra */
            overflow: hidden; /* Restringe el contenido */
            white-space: nowrap; /* Evita saltos de l√≠nea */
            display: flex; /* Usamos flexbox para alinear el texto */
            align-items: center; /* Centra verticalmente el texto */
            justify-content: center; /* Centra horizontalmente el texto */
            color: #fff; /* Color de texto por defecto */
        }
        .barra-container {
            position: relative;
            margin-top: 5px; /* Asegura que el texto alternativo est√© posicionado correctamente */
        }
        .texto-progreso {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            white-space: nowrap;
            font-weight: bold;
            color: black; /* Cambia a un color m√°s visible */
            pointer-events: none; /* Evita que interfiera con los clics */
        }
        #menuList.hidden {
            display: none;
        }
        @media (min-width: 768px) {
            #menuList {
                display: flex !important; /* Siempre mostrar en pantallas m√°s grandes */
            }
        }
        #buscadorVentas {
            border: 2px solid #e5e7eb; /* Un borde claro */
            transition: border-color 0.3s ease; /* Suave transici√≥n */
        }
        #buscadorVentas:focus {
            border-color: #3182ce; /* Cambia el color del borde al enfocarse */
        }

    </style>
<!-- Incluye la librer√≠a de Google API -->
<script src="https://apis.google.com/js/api.js"></script>
</head>
<body class="bg-white p-6 rounded-lg shadow-md">
<div class="container">
            <!-- T√≠tulo -->
            <h1 class="text-4xl text-center font-bold">üìä RINGANA SALES</h1>
    
            <!-- Bot√≥n para dispositivos m√≥viles -->
            <button id="menuButton" class="md:hidden text-white focus:outline-none">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                </svg>
            </button>
    
            <!-- Lista de navegaci√≥n -->
            <nav class="bg-gray-100 p-4 rounded-lg shadow-md mb-6">
                <ul class="flex flex-wrap justify-center gap-4">
                    <li>
                        <button onclick="scrollToSection('ventas')" class="bg-gray-200 text-gray-800 py-2 px-6 rounded-lg hover:bg-gray-300 focus:outline-none transition">
                            üíº REGISTRAR VENTA
                        </button>
                    </li>
                    <li>
                        <button onclick="scrollToSection('meta')" class="bg-gray-200 text-gray-800 py-2 px-6 rounded-lg hover:bg-gray-300 focus:outline-none transition">
                            üèÜ META
                        </button>
                    </li>
                    <li>
                        <button onclick="scrollToSection('registradas')" class="bg-gray-200 text-gray-800 py-2 px-6 rounded-lg hover:bg-gray-300 focus:outline-none transition">
                            üìÖ VENTAS REGISTRADAS
                        </button>
                    </li>
                    <li>
                        <button onclick="scrollToSection('recursos')" class="bg-gray-200 text-gray-800 py-2 px-6 rounded-lg hover:bg-gray-300 focus:outline-none transition">
                            üë©‚Äçü¶∞ GESTI√ìN DE RECURSOS
                        </button>
                    </li>
                    <li>
                        <button onclick="scrollToSection('periodos')" class="bg-gray-200 text-gray-800 py-2 px-6 rounded-lg hover:bg-gray-300 focus:outline-none transition">
                            üéüÔ∏è PERIODOS DE FACTURACI√ìN
                        </button>
                    </li>
                    <li>
                        <button onclick="scrollToSection('datos')" class="bg-gray-200 text-gray-800 py-2 px-6 rounded-lg hover:bg-gray-300 focus:outline-none transition">
                            üìä GESTI√ìN DE DATOS
                        </button>
                    </li>
                </ul>
            </nav>
            
    
    
    <!-- INICIO SECCI√ìN DE REGISTRO DE VENTAS -->
        <div id="ventas" class="mb-8 bg-gray-100 p-6 rounded-lg shadow-md">
            <h2 class="text-2xl font-bold text-center mb-6">üíº REGISTRAR VENTA</h2>
            <form>
                <!-- Fecha de venta -->
                <div class="mb-4">
                    <label for="fechaVenta" class="block font-medium mb-1">üìÖ Fecha de Venta</label>
                    <input id="fechaVenta" type="date" class="w-full border p-3 rounded-md focus:ring-2 focus:ring-blue-500">
                </div>
        
                <!-- Buscador r√°pido de Clientas -->
                <div class="mb-2">
                    <label for="filtrarClientas" class="block font-medium mb-1">üë©‚Äçü¶∞ Clientas</label>
                    <input id="filtrarClientas" type="text" placeholder="Escribe para filtrar..." class="w-full border p-2 rounded-md">
                </div>
                
                <!-- Selector de Clientas -->
                <div class="mb-4">
                    <label for="selectClientas" class="block font-medium mb-1"></label>
                    <select id="selectClientas" multiple class="w-full border p-3 rounded-md focus:ring-2 focus:ring-blue-500">
                    <!-- Opciones din√°micas insertadas desde JavaScript -->
                    </select>
                    <small class="text-gray-500">* Mant√©n presionado "Ctrl" para seleccionar varias opciones.</small>
                </div>
                <!-- Buscador r√°pido de Productos -->
                <div class="mb-2">
                    <label for="filtrarProductos" class="block font-medium mb-1">üõçÔ∏è Productos</label>
                    <input id="filtrarProductos" type="text" placeholder="Escribe para filtrar..." class="w-full border p-2 rounded-md">
                </div>
                
                <!-- Selector de Productos -->
                <div class="mb-4">
                    <label for="selectProductos" class="block font-medium mb-1"></label>
                    <select id="selectProductos" multiple class="w-full border p-3 rounded-md focus:ring-2 focus:ring-blue-500">
                    <!-- Opciones din√°micas insertadas desde JavaScript -->
                    </select>
                </div>
  
        
                <!-- Puntos por Producto -->
                <div id="puntosPorProductoContainer" class="mb-4">
                    <!-- Los inputs din√°micos se a√±aden aqu√≠ con JavaScript -->
                </div>
        
                <!-- Bonos -->
                <div class="mb-4">
                    <label for="selectBonos" class="block font-medium mb-1">üéÅ Bonos</label>
                    <select id="selectBonos" class="w-full border p-3 rounded-md focus:ring-2 focus:ring-blue-500">
                        <!-- Opciones din√°micas insertadas desde JavaScript -->
                    </select>
                </div>
                
                <!-- Comentario -->
                <div class="mb-4">
                    <label for="comentarioVenta" class="block font-medium mb-1">üìù Comentario</label>
                    <input id="comentarioVenta" type="text" placeholder="Escribe un comentario..." class="w-full border p-3 rounded-md focus:ring-2 focus:ring-blue-500">
                </div>
                
                <!-- Bot√≥n de registrar -->
                <button 
                    type="button" 
                    onclick="registrarVenta()" 
                    class="w-full bg-gradient-to-r from-gray-400 via-gray-500 to-blue-600 text-white py-3 px-5 rounded-lg font-semibold shadow-md transform transition-transform duration-300 hover:scale-105 hover:shadow-lg focus:ring-4 focus:ring-green-300">
                    ‚úÖ REGISTRAR VENTA
                </button>
            </form>
        </div>

        <!-- Bot√≥n para volver arriba -->
        <div class="text-center mt-4">
            <button onclick="scrollToTop()" class="bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600">
                ‚¨ÜÔ∏è Volver Arriba
            </button>
        </div>

        <!-- FIN SECCI√ìN DE REGISTRO DE VENTAS -->
        
<!-- Separador de secciones -->
<hr class="my-8">
        
    <!-- INICIO SECCI√ìN META -->
        <div id="meta" class="mb-8 bg-gray-100 p-6 rounded-lg shadow-md">
            <h2 class="text-2xl font-bold text-center mb-6">üèÜ META</h2>
            
            <!-- Tabla de puntos por periodo -->
            <div class="mb-6">
                <!-- Selecci√≥n del periodo actual -->
                <div class="flex flex-wrap gap-4 items-center justify-center mb-6">
                    <label for="selectPeriodoActual" class="text-lg font-medium">Periodo Actual:</label>
                    <select id="selectPeriodoActual" class="border p-2 rounded-lg w-full md:w-auto" onchange="actualizarDatosPeriodoActual()">
                        <!-- Opciones se llenar√°n din√°micamente -->
                    </select>
                </div>
                
                <!-- Indicadores de progreso -->
                <div class="bg-gray-50 p-4 rounded-lg shadow-inner">
                    <ul class="list-disc pl-5 text-gray-800 space-y-2 text-lg">
                        <li>
                            <span class="font-semibold text-blue-600">Meta Alcanzada:</span>
                            <span id="resultadoMeta">Selecciona un periodo para calcular.</span>
                        </li>
                        <li>
                            <span class="font-semibold text-green-600">Puntos restantes:</span>
                            <span id="resultadoPuntosRestantes">Selecciona un periodo para calcular.</span>
                        </li>
                        <li>
                            <span class="font-semibold text-yellow-500">Progreso a mitad del periodo:</span>
                            <span id="progresoMitadPeriodo">Selecciona un periodo para calcular.</span>
                        </li>
                        <li>
                            <span class="font-semibold text-red-500">D√≠as restantes:</span>
                            <span id="diasRestantes">Selecciona un periodo para calcular.</span>
                        </li>
                    </ul>
                    
                    <!-- Barra de progreso -->
                    <div class="mt-6 mb-4">
                        <h4 class="text-lg font-semibold mb-2">Progreso hacia la Meta:</h4>
                        <div class="barra-container">
                            <div class="w-full bg-gray-300 rounded-full h-6">
                                <div id="barraProgreso" class="bg-green-400 h-6 rounded-full"></div>
                            </div>
                            <div class="texto-progreso mb-2" id="textoProgreso"></div>
                        </div>
                    </div>
                    
    
            <!-- Puntos por periodo -->
            <div class="mb-6">
                <h3 class="text-xl font-semibold text-center mb-4">Puntos por Soci@s por periodo</h3>
                <div class="flex flex-wrap gap-4 items-center justify-center mb-4">
                    <select id="selectSocio" class="border p-2 rounded-lg w-full md:w-auto">
                        <!-- Opciones se llenar√°n din√°micamente -->
                    </select>
                    <select id="selectPeriodo" class="border p-2 rounded-lg w-full md:w-auto">
                        <!-- Opciones se llenar√°n din√°micamente -->
                    </select>
                    <input id="puntosVE" type="number" placeholder="Puntos VE" class="border p-2 rounded-lg w-full md:w-auto">
                    <button onclick="registrarPuntosPorSocia()" class="bg-blue-500 text-white p-2 rounded-lg hover:bg-blue-600">‚ûï</button>
                </div>
    
                <!-- Tabla de puntos -->
                <div class="overflow-auto">
                    <table class="min-w-full bg-white border rounded-lg">
                        <thead>
                            <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                                <th class="py-2 px-4 text-left">Socio</th>
                                <th class="py-2 px-4 text-left">Periodo</th>
                                <th class="py-2 px-4 text-left">Puntos VE</th>
                                <th class="py-2 px-4 text-center">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tablaPuntos" class="text-gray-600 text-sm">
                            <!-- Contenido din√°mico -->
                        </tbody>
                    </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bot√≥n para volver arriba -->
        <div class="text-center mt-4">
            <button onclick="scrollToTop()" class="bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600">
                ‚¨ÜÔ∏è Volver Arriba
            </button>
        </div>


<!-- Separador de secciones -->
<hr class="my-8">

<!-- INICIO SECCI√ìN DE VENTAS REGISTRADAS -->
<div id="registradas" class="mb-8 bg-gray-100 p-6 rounded-lg shadow-md">
    <h2 class="text-2xl font-bold text-center mb-6">üìÖ VENTAS REGISTRADAS</h2>

    <!-- Filtros y Buscador -->
    <div class="bg-white p-6 rounded-lg shadow-md mb-6">
        <h3 class="text-lg font-semibold mb-4 text-gray-800">üîç Buscar y Filtrar Ventas</h3>

        <!-- Buscador -->
        <div class="flex flex-wrap items-center gap-4 mb-4">
            <input 
                id="buscadorVentas" 
                type="text" 
                placeholder="Buscar por clienta, producto, comentario, etc." 
                class="flex-1 border p-2 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" 
                oninput="buscarEnTiempoReal()"
            >
        </div>

        <!-- Tipo de Filtro y Criterios -->
        <div class="flex flex-wrap items-center gap-4 mb-4">
            <label for="filtroTipo" class="block text-sm font-medium text-gray-700">Tipo de Filtro:</label>
            <select id="filtroTipo" class="border p-2 rounded-md focus:ring-blue-500 focus:border-blue-500" onchange="mostrarCriterio()">
                <option value="">Seleccionar filtro</option>
                <option value="ano">A√±o</option>
                <option value="mes">Mes</option>
                <option value="cliente">Clienta</option>
                <option value="producto">Producto</option>
                <option value="fecha">Entre fechas</option>
            </select>

            <!-- Criterios Din√°micos -->
            <div id="criteriosFiltro" class="flex items-center gap-4">
                <!-- Los campos din√°micos generados por JS aparecer√°n aqu√≠ -->
            </div>
        </div>

        <!-- Botones de Acci√≥n -->
        <div class="flex justify-between">
            <button onclick="filtrarVentas()" class="bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 shadow-md transition">
                Aplicar Filtros
            </button>
            <button onclick="restaurarFiltros()" class="bg-red-500 text-white py-2 px-4 rounded-lg hover:bg-red-600 shadow-md transition">
                Restaurar Filtros
            </button>
        </div>
    </div>

    <!-- Tabla de Ventas -->
    <div class="scrollable">
        <table class="min-w-full bg-white border rounded-lg">
            <thead>
                <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                    <th class="py-2 px-4 text-left">Periodo de Facturaci√≥n</th>
                    <th class="py-2 px-4 text-left">Fecha</th>
                    <th class="py-2 px-4 text-left">Clientas</th>
                    <th class="py-2 px-4 text-left">Productos</th>
                    <th class="py-2 px-4 text-left">Puntos</th>
                    <th class="py-2 px-4 text-left">Bono</th>
                    <th class="py-2 px-4 text-left">Comentario</th>
                    <th class="py-2 px-4 text-center">Acciones</th>
                </tr>
            </thead>
            <tbody id="tablaVentas" class="text-gray-600 text-sm">
                <!-- Contenido din√°mico generado por JavaScript -->
            </tbody>
        </table>
    </div>

    <!-- Bot√≥n para Exportar a Excel -->
    <div class="text-center mt-4">
        <button onclick="exportarVentasExcel()" class="bg-green-500 text-white py-2 px-4 rounded-lg hover:bg-green-600 shadow-md transition">
            üì• Exportar a Excel
        </button>
    </div>
</div>
  <!-- Bot√≥n para volver arriba -->
  <div class="text-center mt-4">
    <button onclick="scrollToTop()" class="bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600">
        ‚¨ÜÔ∏è Volver Arriba
    </button>
</div>

<!-- Separador de secciones -->
<hr class="my-8">
    
    <!-- INICIO SECCION GESTION DE RECURSOS -->
    <div id="recursos" class="mb-8 bg-gray-100 p-6 rounded-lg shadow-md">
        <h2 class="text-2xl font-bold text-center mb-6">üë©‚Äçü¶∞ GESTI√ìN DE RECURSOS</h2>
            <div class="grid grid-cols-1 gap-4">
            <!-- Productos -->
            <!-- Gesti√≥n de Recursos - Productos -->
            <div class="bg-gray-300 p-4 rounded-lg shadow-md">
                <h3 class="text-xl font-semibold text-center mb-4">üõçÔ∏è Productos</h3>
                
                <!-- Inputs y Botones -->
            <div class="flex items-center gap-4">
                <!-- Inputs -->
               <!-- Ejemplo en la secci√≥n de Gesti√≥n de Productos -->
                <!-- Ejemplo en la secci√≥n de Gesti√≥n de Productos -->
                <input id="nuevoProducto" type="text" placeholder="Nombre del producto" class="flex-1 p-2 border rounded-md">
                <input id="puntosProducto" type="number" placeholder="Puntos" class="w-24 p-2 border rounded-md" min="0">
                <input id="mesAvisoProducto" type="number" placeholder="Meses de aviso" class="w-36 p-2 border rounded-md" min="0">

                <!-- Botones (sin texto, solo √≠conos) -->
                <button onclick="agregarProducto()" class="p-2 rounded-full bg-blue-500 text-white hover:bg-blue-600">
                    ‚ûï
                </button>
                <button onclick="toggleProductos()" class="p-2 rounded-full bg-gray-500 text-white hover:bg-gray-600">
                    üëÅÔ∏è
                </button>
            </div>

            <!-- Lista de Productos -->
            <div id="productos" class="scrollable mt-4 hidden">
                <!-- Contenido din√°mico generado por JavaScript -->
            </div>
        </div>

            

            <!-- Clientas -->
            <div class="bg-gray-300 p-4 rounded-lg shadow-md">
                <h3 class="text-xl font-semibold text-center mb-4">üë©‚Äçü¶∞ Clientas</h3>
                <div class="flex items-center gap-2">
                    <input id="nuevaClienta" type="text" placeholder="Nueva clienta" class="flex-1 p-2 border rounded-md">
                    <button onclick="agregarClienta()" class="p-2 rounded-full bg-blue-500 text-white hover:bg-blue-600">
                        ‚ûï
                    </button>
                    <button onclick="toggleClientas()" class="p-2 rounded-full bg-gray-500 text-white hover:bg-gray-600">
                        üëÅÔ∏è
                    </button>
                </div>
                <div id="clientas" class="scrollable mt-2 hidden"></div>
            </div>

            <!-- Bonos -->
            <div class="bg-gray-300 p-4 rounded-lg shadow-md">
                <h3 class="text-xl font-semibold text-center mb-4">üéÅ Bonos</h3>
                <div class="flex items-center gap-2">
                    <input id="nuevoBono" type="text" placeholder="Nuevo bono" class="flex-1 p-2 border rounded-md">
                    <button onclick="agregarBono()" class="p-2 rounded-full bg-blue-500 text-white hover:bg-blue-600">
                        ‚ûï
                    </button>
                    <button onclick="toggleBonos()" class="p-2 rounded-full bg-gray-500 text-white hover:bg-gray-600">
                        üëÅÔ∏è
                    </button>
                </div>
                <div id="bonos" class="scrollable mt-2 hidden"></div>
            </div>

            <!-- Socios -->
            <div class="bg-gray-300 p-4 rounded-lg shadow-md">
                <h3 class="text-xl font-semibold text-center mb-4">ü§ù Socios</h3>
                <div class="flex items-center gap-2">
                    <input id="nuevoSocio" type="text" placeholder="Nuevo socio" class="flex-1 p-2 border rounded-md">
                    <button onclick="agregarSocio()" class="p-2 rounded-full bg-blue-500 text-white hover:bg-blue-600">
                        ‚ûï
                    </button>
                    <button onclick="toggleSocios()" class="p-2 rounded-full bg-gray-500 text-white hover:bg-gray-600">
                        üëÅÔ∏è
                    </button>
                </div>
                <div id="socios" class="scrollable mt-2 hidden"></div>
            </div>
        </div>
    </div>
    <!-- FIN SECCION GESTION DE RECURSOS -->
    
    <!-- Bot√≥n para volver arriba -->
    <div class="text-center mt-4">
        <button onclick="scrollToTop()" class="bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600">
            ‚¨ÜÔ∏è Volver Arriba
        </button>
    </div>

<!-- Separador de secciones -->
<hr class="my-8">


<!-- INICIO SECCION PERIODOS DE FACTURACION -->
        <div id="periodos" class="mb-8 bg-gray-100 p-6 rounded-lg shadow-md">
            <h2 class="text-2xl font-bold text-center mb-6">üéüÔ∏è PERIODOS DE FACTURACI√ìN</h2>
            <div class="flex flex-wrap gap-2 mb-2">
                <input id="nombrePeriodo" type="text" placeholder="Nombre del periodo (e.g., Marzo25)" class="border p-2">
                <input id="fechaInicioPeriodo" type="date" class="border p-2">
                <input id="fechaFinPeriodo" type="date" class="border p-2">
                <button onclick="agregarPeriodo()" class="add-button"><span class="icon">‚ûï</span></button>
            </div>
            <div class="scrollable">
                <table class="min-w-full bg-white mt-2">
                    <thead>
                        <tr>
                            <th class="py-2 px-4 border">Nombre del Periodo</th>
                            <th class="py-2 px-4 border">Fecha Inicio</th>
                            <th class="py-2 px-4 border">Fecha Fin</th>
                            <th class="py-2 px-4 border">Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tablaPeriodos"></tbody>
                </table>
            </div>
        </div>

        <!-- Bot√≥n para volver arriba -->
        <div class="text-center mt-4">
            <button onclick="scrollToTop()" class="bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600">
                ‚¨ÜÔ∏è Volver Arriba
            </button>
        </div>

<!-- Separador de secciones -->
<hr class="my-8">

    <!-- Secci√≥n de exportar e importar -->
    <div id="datos" class="mb-8 bg-gray-100 p-6 rounded-lg shadow-md">
        <h2 class="text-2xl font-bold text-center mb-6">üìä GESTI√ìN DE DATOS</h2>

        <div class="mb-4">
            <h2 class="text-2xl font-semibold mb-2">Importar y Exportar üóÇÔ∏è</h2>
            <input type="file" id="importarArchivo" accept=".csv" class="mb-2">
            <button onclick="importarDatos()" class="bg-blue-500 text-white p-2 rounded">Importar</button>
            <button onclick="exportarDatos()" class="bg-red-500 text-white p-2 ml-2 rounded">Exportar</button>
        </div>
    

        <!-- Secci√≥n de copia de seguridad -->
        <div class="mb-4">
            <h2 class="text-2xl font-semibold mb-2">Copia de Seguridad üíæ</h2>
            <input type="file" id="cargarCopiaSeguridad" accept=".json" class="mt-2">
            <button onclick="restaurarCopiaSeguridad()" class="bg-blue-500 text-white p-2 ml-2 rounded">Restaurar CS</button>
            <button onclick="guardarCopiaSeguridad()" class="bg-red-500 text-white p-2 rounded">Guardar CS</button>
            <button onclick="borrarLocalStorage()" class="bg-red-500 text-white p-2 rounded-lg">Borrar Todo</button>
        </div>
    </div>  
</div> 

    <!-- Bot√≥n para volver arriba -->
    <div class="text-center mt-4">
        <button onclick="scrollToTop()" class="bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600">
            ‚¨ÜÔ∏è Volver Arriba
        </button>
    </div>

</div>


<!-- *************************************************************************** CAMBIO A SCRIPT *************************************************************************** -->

<script>
// Inicializaci√≥n de variables globales
let productos = JSON.parse(localStorage.getItem('productos')) || [];
let clientas = JSON.parse(localStorage.getItem('clientas')) || [];
let bonos = JSON.parse(localStorage.getItem('bonos')) || [];
let ventas = JSON.parse(localStorage.getItem('ventas')) || [];
let socios = JSON.parse(localStorage.getItem('socios')) || [];
let puntos = JSON.parse(localStorage.getItem('puntos')) || [];
let periodos = JSON.parse(localStorage.getItem('periodos')) || [];
let orden = 'reciente'; // Orden por defecto

        // *************************************************************************** Gesti√≥n de PRODUCTOS *************************************************************************** // 
        function mostrarProductos() {
        const divProductos = document.getElementById('productos');
        divProductos.innerHTML = '';
        productos.forEach((producto, index) => {
            divProductos.innerHTML += `
                <div class="flex items-center justify-between">
                    <span id="productoRec-span-${index}">${producto.nombre}</span> 
                    <span id="puntosRec-span-${index}">Puntos: ${producto.puntos}</span>
                    <input type="text" value="${producto.nombre}" id="productoRec-input-${index}" class="border p-2 hidden">
                    <input type="number" value="${producto.puntos}" id="puntosRec-input-${index}" class="border p-2 hidden">
                    <div>
                        <!-- AQU√ç MODIFICAMOS -->
                        <button class="icon-button" id="editarProductoRec-${index}" onclick="editarProducto(${index})">‚úèÔ∏è</button>
                        <button class="icon-button hidden" id="guardarProductoRec-${index}" onclick="guardarProducto(${index})">üíæ</button>
                        <button class="icon-button" onclick="eliminarProducto(${index})">‚ùå</button>
                    </div>
                </div>
            `;
        });
        actualizarSelectProductos();
    }

    function agregarProducto() {
        const nuevoProducto = document.getElementById('nuevoProducto').value.trim();
        const puntosProducto = parseInt(document.getElementById('puntosProducto').value, 10);
        const mesAviso = parseInt(document.getElementById('mesAvisoProducto').value, 10); // Nuevo campo de meses

        if (!nuevoProducto) {
            alert("El nombre del producto no puede estar vac√≠o.");
            return;
        }
        if (isNaN(puntosProducto) || puntosProducto < 0) {
            alert("Por favor, introduce un valor v√°lido para los puntos.");
            return;
        }
        // Verificar duplicados
        const productoExistente = productos.find(p => p.nombre.toLowerCase() === nuevoProducto.toLowerCase());
        if (productoExistente) {
            alert("Este producto ya existe. Intenta con otro nombre.");
            return;
        }
        // Agregar el producto al array
        productos.push({ nombre: nuevoProducto, puntos: puntosProducto });
        document.getElementById('nuevoProducto').value = '';
        document.getElementById('puntosProducto').value = '';
        document.getElementById('mesAvisoProducto').value = '';

        guardarLocalStorage();
        mostrarProductos();
    }

    function eliminarProducto(index) {
        const confirmar = confirm("¬øEst√°s seguro de que deseas eliminar este producto?");
        if (confirmar) {
            productos.splice(index, 1);
            guardarLocalStorage();
            mostrarProductos();
        }
    }

    function editarProducto(index) {
        document.getElementById(`productoRec-span-${index}`).classList.add('hidden');
        document.getElementById(`puntosRec-span-${index}`).classList.add('hidden');
        document.getElementById(`productoRec-input-${index}`).classList.remove('hidden');
        document.getElementById(`puntosRec-input-${index}`).classList.remove('hidden');
        document.getElementById(`editarProductoRec-${index}`).classList.add('hidden');
        document.getElementById(`guardarProductoRec-${index}`).classList.remove('hidden');
    }

    function guardarProducto(index) {
        const nuevoNombre = document.getElementById(`productoRec-input-${index}`).value.trim();
        const nuevosPuntos = parseInt(document.getElementById(`puntosRec-input-${index}`).value, 10);

        if (!nuevoNombre || isNaN(nuevosPuntos) || nuevosPuntos < 0) {
            alert("Por favor, completa correctamente todos los campos.");
            return;
        }

        const productoExistente = productos.find((producto, i) => i !== index && producto.nombre.toLowerCase() === nuevoNombre.toLowerCase());
        if (productoExistente) {
            alert("Ya existe un producto con este nombre. Usa un nombre diferente.");
            return;
        }

        productos[index] = { nombre: nuevoNombre, puntos: nuevosPuntos };
        guardarLocalStorage();

        // üîΩ REFRESCA LA LISTA
        mostrarProductos();
    }


    function actualizarSelectProductos() {
        const selectProductos = document.getElementById('selectProductos');
        selectProductos.innerHTML = ''; // Limpiar las opciones existentes

        productos.forEach(producto => {
            // Mostrar solo el nombre del producto en el selector
            selectProductos.innerHTML += `<option value="${producto.nombre}">${producto.nombre}</option>`;
        });
    }

        // *************************************************************************** Gesti√≥n de CLIENTAS *************************************************************************** // 

    function mostrarClientas() {
        const divClientas = document.getElementById('clientas');
        divClientas.innerHTML = '';
        clientas.forEach((clienta, index) => {
            divClientas.innerHTML += `
                <div class="flex items-center justify-between">
                    <span id="clientaRec-span-${index}">${clienta}</span>
                    <input type="text" value="${clienta}" id="clientaRec-input-${index}" class="border p-2 hidden">
                    <div>
                        <button class="icon-button" id="editarClientaRec-${index}" onclick="editarClienta(${index})">‚úèÔ∏è</button>
                        <button class="icon-button hidden" id="guardarClientaRec-${index}" onclick="guardarClienta(${index})">üíæ</button>
                        <button class="icon-button" onclick="eliminarClienta(${index})">‚ùå</button>
                    </div>
                </div>
            `;
        });
        actualizarSelectClientas();
    }

    function agregarClienta() {
        const nuevaClienta = document.getElementById('nuevaClienta').value.trim();

        if (!nuevaClienta) {
            alert("El nombre de la clienta no puede estar vac√≠o.");
            return;
        }

        // Verificar duplicados
        const clientaExistente = clientas.find(clienta => clienta.toLowerCase() === nuevaClienta.toLowerCase());
        if (clientaExistente) {
            alert("Esta clienta ya existe. Intenta con otro nombre.");
            return;
        }

        // Agregar la clienta al array
        clientas.push(nuevaClienta);
        document.getElementById('nuevaClienta').value = '';
        guardarLocalStorage();
        mostrarClientas();
    }

    function editarClienta(index) {
            document.getElementById(`clientaRec-span-${index}`).classList.add('hidden');
            document.getElementById(`clientaRec-input-${index}`).classList.remove('hidden');

            document.getElementById(`editarClientaRec-${index}`).classList.add('hidden');
            document.getElementById(`guardarClientaRec-${index}`).classList.remove('hidden');
        }

    function guardarClienta(index) {
        const nuevaClienta = document.getElementById(`clientaRec-input-${index}`).value.trim();
        if (!nuevaClienta) {
            alert("El nombre de la clienta no puede estar vac√≠o.");
            return;
        }
        // Verificar si el nombre ya existe en otro cliente
        const clientaExistente = clientas.find((clienta, i) => i !== index && clienta.toLowerCase() === nuevaClienta.toLowerCase());
        if (clientaExistente) {
            alert("Ya existe una clienta con este nombre. Usa un nombre diferente.");
            return;
        }
        // Actualizar el nombre de la clienta en el array
        clientas[index] = nuevaClienta;
        guardarLocalStorage();

        // Actualizar la interfaz
        const spanElement = document.getElementById(`clientaRec-span-${index}`);
        const inputElement = document.getElementById(`clientaRec-input-${index}`);
        const guardarBoton = document.getElementById(`guardarClientaRec-${index}`);
        const editarBoton = document.getElementById(`editarClientaRec-${index}`);

        // Actualizar el texto del span
        spanElement.textContent = nuevaClienta;

        // Alternar visibilidad entre span e input
        spanElement.classList.remove('hidden');
        inputElement.classList.add('hidden');

        // Alternar visibilidad de botones
        guardarBoton.classList.add('hidden');
        editarBoton.classList.remove('hidden');

        // Sincronizar los selectores con los datos actualizados
        actualizarSelectClientas();
    }   



    function eliminarClienta(index) {
        const confirmar = confirm("¬øEst√°s seguro de que deseas eliminar este cliente?");
        if (confirmar) {
            clientas.splice(index, 1);
            guardarLocalStorage();
            mostrarClientas();
        }
    }

    function actualizarSelectClientas() {
        const selectClientas = document.getElementById('selectClientas');
        selectClientas.innerHTML = '';
        clientas.forEach(clienta => {
            selectClientas.innerHTML += `<option value="${clienta}">${clienta}</option>`;
        });
    }

        // *************************************************************************** Gesti√≥n de BONOS *************************************************************************** // 

    function mostrarBonos() {
        const divBonos = document.getElementById('bonos');
        divBonos.innerHTML = '';
        bonos.forEach((bono, index) => {
            divBonos.innerHTML += `
                <div class="flex items-center justify-between">
                    <span id="bonoRec-span-${index}">${bono}</span>
                    <input type="text" value="${bono}" id="bonoRec-input-${index}" class="border p-2 hidden">
                    <div>
                        <button class="icon-button" id="editarBonoRec-${index}" onclick="editarBonoRec(${index})">‚úèÔ∏è</button>
                        <button class="icon-button hidden" id="guardarBonoRec-${index}" onclick="guardarBonoRec(${index})">üíæ</button>
                        <button class="icon-button" onclick="eliminarBono(${index})">‚ùå</button>
                    </div>
                </div>
            `;
        });
        actualizarSelectBonos();
    }

    function agregarBono() {
        const nuevoBono = document.getElementById('nuevoBono').value.trim();

        if (!nuevoBono) {
            alert("El nombre del bono no puede estar vac√≠o.");
            return;
        }
        const bonoExistente = bonos.find(b => b.toLowerCase() === nuevoBono.toLowerCase());
        if (bonoExistente) {
            alert("Este bono ya existe. Intenta con otro nombre.");
            return;
        }
        bonos.push(nuevoBono);
        document.getElementById('nuevoBono').value = '';
        guardarLocalStorage();
        mostrarBonos();
    }

    function editarBonoRec(index) {
        document.getElementById(`bonoRec-span-${index}`).classList.add('hidden');
        document.getElementById(`bonoRec-input-${index}`).classList.remove('hidden');

        document.getElementById(`editarBonoRec-${index}`).classList.add('hidden');
        document.getElementById(`guardarBonoRec-${index}`).classList.remove('hidden');
    }

    function guardarBonoRec(index) {
        const nuevoBono = document.getElementById(`bonoRec-input-${index}`).value.trim();

        if (!nuevoBono) {
            alert("El bono no puede estar vac√≠o.");
            return;
        }
        const bonoExistente = bonos.find((bono, i) => i !== index && bono.toLowerCase() === nuevoBono.toLowerCase());
        if (bonoExistente) {
            alert("Ya existe un bono con este nombre. Usa un nombre diferente.");
            return;
        }
        bonos[index] = nuevoBono;
        guardarLocalStorage();
        const spanElement = document.getElementById(`bonoRec-span-${index}`);
        const inputElement = document.getElementById(`bonoRec-input-${index}`);
        const guardarBoton = document.getElementById(`guardarBonoRec-${index}`);
        const editarBoton = document.getElementById(`editarBonoRec-${index}`);
        spanElement.textContent = nuevoBono;
        spanElement.classList.remove('hidden');
        inputElement.classList.add('hidden');
        guardarBoton.classList.add('hidden');
        editarBoton.classList.remove('hidden');

        actualizarSelectBonos();
    }

    function eliminarBono(index) {
        const confirmar = confirm("¬øEst√°s seguro de que deseas eliminar este bono?");
        if (confirmar) {
            bonos.splice(index, 1);
            guardarLocalStorage();
            mostrarBonos();
        }
    }

    function actualizarSelectBonos() {
        const selectBonos = document.getElementById('selectBonos');
        selectBonos.innerHTML = '<option value="">Seleccionar bono</option>';
        bonos.forEach(bono => {
            selectBonos.innerHTML += `<option value="${bono}">${bono}</option>`;
        });
    }


        // *************************************************************************** Gesti√≥n de SOCIOS *************************************************************************** // 

    function mostrarSocios() {
        const divSocios = document.getElementById('socios');
        divSocios.innerHTML = '';
        socios.forEach((socio, index) => {
            divSocios.innerHTML += `
                <div class="flex items-center justify-between">
                    <span id="socioRec-span-${index}">${socio}</span>
                    <input type="text" value="${socio}" id="socioRec-input-${index}" class="border p-2 hidden">
                    <div>
                        <button class="icon-button" id="editarSocioRec-${index}" onclick="editarSocioRec(${index})">‚úèÔ∏è</button>
                        <button class="icon-button hidden" id="guardarSocioRec-${index}" onclick="guardarSocioRec(${index})">üíæ</button>
                        <button class="icon-button" onclick="eliminarSocio(${index})">‚ùå</button>
                    </div>
                </div>
            `;
        });
        actualizarSelectSocios();
    }

    function agregarSocio() {
        const nuevoSocio = document.getElementById('nuevoSocio').value.trim();

        if (!nuevoSocio) {
            alert("El nombre del socio no puede estar vac√≠o.");
            return;
        }

        // Verificar duplicados
        const socioExistente = socios.find(s => s.toLowerCase() === nuevoSocio.toLowerCase());
        if (socioExistente) {
            alert("Este socio ya existe. Intenta con otro nombre.");
            return;
        }

        socios.push(nuevoSocio);
        document.getElementById('nuevoSocio').value = '';
        guardarLocalStorage();
        mostrarSocios();
    }

    function editarSocioRec(index) {
        document.getElementById(`socioRec-span-${index}`).classList.add('hidden');
        document.getElementById(`socioRec-input-${index}`).classList.remove('hidden');

        document.getElementById(`editarSocioRec-${index}`).classList.add('hidden');
        document.getElementById(`guardarSocioRec-${index}`).classList.remove('hidden');
    }

    function guardarSocioRec(index) {
        const nuevoSocio = document.getElementById(`socioRec-input-${index}`).value.trim();

        if (!nuevoSocio) {
            alert("El nombre del socio no puede estar vac√≠o.");
            return;
        }

        // Verificar duplicados
        const socioExistente = socios.find((s, i) => i !== index && s.toLowerCase() === nuevoSocio.toLowerCase());
        if (socioExistente) {
            alert("Ya existe un socio con este nombre. Usa un nombre diferente.");
            return;
        }

        socios[index] = nuevoSocio;
        guardarLocalStorage();

        // Actualizar interfaz
        const spanElement = document.getElementById(`socioRec-span-${index}`);
        const inputElement = document.getElementById(`socioRec-input-${index}`);
        const guardarBoton = document.getElementById(`guardarSocioRec-${index}`);
        const editarBoton = document.getElementById(`editarSocioRec-${index}`);

        spanElement.textContent = nuevoSocio;

        spanElement.classList.remove('hidden');
        inputElement.classList.add('hidden');
        guardarBoton.classList.add('hidden');
        editarBoton.classList.remove('hidden');

        actualizarSelectSocios();
    }

    function eliminarSocio(index) {
        const confirmar = confirm("¬øEst√°s seguro de que deseas eliminar este socio?");
        if (confirmar) {
            socios.splice(index, 1);
            guardarLocalStorage();
            mostrarSocios();
        }
    }

    function actualizarSelectSocios() {
        const selectSocio = document.getElementById('selectSocio');
        selectSocio.innerHTML = '';
        socios.forEach(socio => {
            selectSocio.innerHTML += `<option value="${socio}">${socio}</option>`;
        });
    }
// FIN SOCIOS!
    function exportarDatos() {
        const datos = [
            ['Fecha', 'Clientas', 'Productos', 'Bono', 'Puntos', 'Comentario'],
            ...ventas.map(venta => [venta.fecha, venta.clienta, venta.producto, venta.bono, venta.puntos, venta.comentario])
        ];
        const csvContent = datos.map(e => e.join(",")).join("\n");
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'ventas.csv';
        a.click();
        URL.revokeObjectURL(url);
    }



        // *************************************************************************** Gesti√≥n de VENTAS *************************************************************************** // 

    function mostrarVentas() {
        const tablaVentas = document.getElementById('tablaVentas');
        tablaVentas.innerHTML = ''; // Limpiar la tabla antes de llenarla

        if (ventas.length === 0) {
            tablaVentas.innerHTML = '<tr><td colspan="8" class="text-center py-4">No hay ventas registradas.</td></tr>';
            return;
        }

        ventas.forEach((venta, index) => {
            const periodo = encontrarPeriodo(venta.fecha); // Determinar el periodo de facturaci√≥n

            tablaVentas.innerHTML += `
                <tr>
                    <td class="py-2 px-4 border">
                        <span id="periodo-span-${index}">${periodo || 'No asignado'}</span>
                        <input type="text" id="periodo-input-${index}" value="${periodo || 'No asignado'}" class="hidden border p-2 w-full">
                    </td>
                    <td class="py-2 px-4 border">
                        <span id="fecha-span-${index}">${venta.fecha}</span>
                        <input type="date" id="fecha-input-${index}" value="${venta.fecha}" class="hidden border p-2 w-full">
                    </td>
                    <td class="py-2 px-4 border">
                        <span id="clienta-span-${index}">${venta.clienta}</span>
                        <input type="text" id="clienta-input-${index}" value="${venta.clienta}" class="hidden border p-2 w-full">
                    </td>
                    <td class="py-2 px-4 border">
                        <span id="producto-span-${index}">${venta.producto}</span>
                        <input type="text" id="producto-input-${index}" value="${venta.producto}" class="hidden border p-2 w-full">
                    </td>
                    <td class="py-2 px-4 border">
                        <span id="puntos-span-${index}">${venta.puntos}</span>
                        <input type="number" id="puntos-input-${index}" value="${venta.puntos}" class="hidden border p-2 w-full">
                    </td>
                    <td class="py-2 px-4 border">
                        <span id="bono-span-${index}">${venta.bono || ''}</span>
                        <input type="text" id="bono-input-${index}" value="${venta.bono || ''}" class="hidden border p-2 w-full">
                    </td>
                    <td class="py-2 px-4 border">
                        <span id="comentario-span-${index}">${venta.comentario || ''}</span>
                        <input type="text" id="comentario-input-${index}" value="${venta.comentario || ''}" class="hidden border p-2 w-full">
                    </td>
                    <td class="py-2 px-4 border text-center">
                        <button class="icon-button" id="editarVenta-${index}" onclick="habilitarEdicionVenta(${index})">‚úèÔ∏è</button>
                        <button class="icon-button hidden" id="guardarVenta-${index}" onclick="guardarVenta(${index})">üíæ</button>
                        <button class="icon-button" onclick="eliminarVenta(${index})">‚ùå</button>
                    </td>
                </tr>
            `;
        });
    }


    function registrarVenta() {
        const fechaVenta = document.getElementById('fechaVenta').value;
        const clientasSeleccionadas = Array.from(document.getElementById('selectClientas').selectedOptions)
                                        .map(option => option.value);
        const productosSeleccionados = Array.from(document.getElementById('selectProductos').selectedOptions)
                                            .map(option => option.value);
        const bonoSeleccionado = document.getElementById('selectBonos').value;
        const comentarioVenta = document.getElementById('comentarioVenta').value.trim();

        if (!fechaVenta || clientasSeleccionadas.length === 0 || productosSeleccionados.length === 0) {
            alert("Por favor, completa todos los campos obligatorios antes de registrar la venta.");
            return;
        }

        // Convertir la fecha de venta a objeto Date para poder sumar d√≠as y meses
        let fechaVentaObj = new Date(fechaVenta);

        // Procesar cada combinaci√≥n de clienta y producto
        clientasSeleccionadas.forEach(clienta => {
            productosSeleccionados.forEach(productoNombre => {
                const inputPuntos = document.getElementById(`puntos-${productoNombre}`);
                const puntos = inputPuntos ? parseInt(inputPuntos.value, 10) || 0 : 0;

                // Agregar la venta al array de ventas
                ventas.push({
                    fecha: fechaVenta,
                    clienta: clienta,
                    producto: productoNombre,
                    bono: bonoSeleccionado || '',
                    puntos: puntos,
                    comentario: comentarioVenta || ''
                });

                // Crear alerta de seguimiento de env√≠o a los 7 d√≠as
                let fechaEvento7 = new Date(fechaVentaObj);
                fechaEvento7.setDate(fechaEvento7.getDate() + 7);
                let titulo7 = `Seguimiento de env√≠o - ${clienta} - ${productoNombre}`;
                let descripcion7 = "Revisar si el producto ha llegado.";
                crearEventoGoogleCalendar(titulo7, fechaEvento7, descripcion7);

                // Crear alerta de feedback a los 15 d√≠as
                let fechaEvento15 = new Date(fechaVentaObj);
                fechaEvento15.setDate(fechaEvento15.getDate() + 15);
                let titulo15 = `Feedback producto - ${clienta} - ${productoNombre}`;
                let descripcion15 = "Ver c√≥mo le ha ido el producto al cliente.";
                crearEventoGoogleCalendar(titulo15, fechaEvento15, descripcion15);

                // Crear alerta basada en el mesAviso del producto
                const productoObj = productos.find(p => p.nombre === productoNombre);
                if (productoObj && productoObj.mesAviso && productoObj.mesAviso > 0) {
                    let fechaAvisoCalculada = new Date(fechaVentaObj);
                    fechaAvisoCalculada.setMonth(fechaAvisoCalculada.getMonth() + productoObj.mesAviso);
                    let tituloAvisoCalc = `Aviso de reposici√≥n - ${clienta} - ${productoNombre}`;
                    let descripcionAvisoCalc = "Revisar aviso calculado para reposici√≥n de producto.";
                    crearEventoGoogleCalendar(tituloAvisoCalc, fechaAvisoCalculada, descripcionAvisoCalc);
                }
            });
        });

        // Guardar ventas en localStorage y actualizar la interfaz
        guardarLocalStorage();
        mostrarVentas();
        actualizarDatosPeriodoActual();

        // Limpiar los campos del formulario
        document.getElementById('fechaVenta').value = new Date().toISOString().split('T')[0];
        document.getElementById('comentarioVenta').value = '';
        document.getElementById('selectClientas').value = '';
        document.getElementById('selectProductos').value = '';
        document.getElementById('selectBonos').value = '';
        document.getElementById('puntosPorProductoContainer').innerHTML = '';
    }



    function editarVenta(index) {
        // Seleccionar fila correspondiente
        const fila = document.getElementById('tablaVentas').rows[index];

        // Habilitar todos los inputs en la fila
        fila.querySelectorAll('input').forEach(input => {
            input.disabled = false; // Habilitar edici√≥n
        });

        // Alternar visibilidad de botones
        const editarBoton = fila.querySelector(`button[onclick="editarVenta(${index})"]`);
        const guardarBoton = fila.querySelector(`button[onclick="guardarEdicion(${index})"]`);

        if (editarBoton && guardarBoton) {
            editarBoton.style.display = 'none'; // Ocultar bot√≥n Editar
            guardarBoton.style.display = 'inline'; // Mostrar bot√≥n Guardar
        } else {
            console.error("No se encontraron los botones de edici√≥n/guardado para el √≠ndice:", index);
        }
    }

    function habilitarEdicionVenta(index) {
        // Ocultar spans y mostrar inputs en la fila de ventas
        document.getElementById(`fecha-span-${index}`).classList.add('hidden');
        document.getElementById(`clienta-span-${index}`).classList.add('hidden');
        document.getElementById(`producto-span-${index}`).classList.add('hidden');
        document.getElementById(`puntos-span-${index}`).classList.add('hidden');
        document.getElementById(`bono-span-${index}`).classList.add('hidden');
        document.getElementById(`comentario-span-${index}`).classList.add('hidden');

        document.getElementById(`fecha-input-${index}`).classList.remove('hidden');
        document.getElementById(`clienta-input-${index}`).classList.remove('hidden');
        document.getElementById(`producto-input-${index}`).classList.remove('hidden');
        document.getElementById(`puntos-input-${index}`).classList.remove('hidden');
        document.getElementById(`bono-input-${index}`).classList.remove('hidden');
        document.getElementById(`comentario-input-${index}`).classList.remove('hidden');

        // Alternar botones
        document.getElementById(`editarVenta-${index}`).classList.add('hidden');
        document.getElementById(`guardarVenta-${index}`).classList.remove('hidden');
    }

    function guardarVenta(index) {
        const nuevaFecha = document.getElementById(`fecha-input-${index}`).value.trim();
        const nuevaClienta = document.getElementById(`clienta-input-${index}`).value.trim();
        const nuevoProducto = document.getElementById(`producto-input-${index}`).value.trim();
        const nuevosPuntos = parseInt(document.getElementById(`puntos-input-${index}`).value, 10);
        const nuevoBono = document.getElementById(`bono-input-${index}`).value.trim();
        const nuevoComentario = document.getElementById(`comentario-input-${index}`).value.trim();

        // Validaciones
        if (!nuevaFecha || !nuevaClienta || !nuevoProducto || isNaN(nuevosPuntos) || nuevosPuntos < 0) {
            alert("Por favor, completa correctamente todos los campos.");
            return;
        }

        // Actualizar el array de ventas
        ventas[index] = {
            fecha: nuevaFecha,
            clienta: nuevaClienta,
            producto: nuevoProducto,
            puntos: nuevosPuntos,
            bono: nuevoBono,
            comentario: nuevoComentario,
        };

        guardarLocalStorage();
        mostrarVentas(); // Refrescar la tabla

        // Actualizar datos del periodo actual (si aplica)
        actualizarDatosPeriodoActual();
    }

    function guardarEdicion(index) {
        // Seleccionar fila correspondiente
        const fila = document.getElementById('tablaVentas').rows[index];

        // Obtener los valores editados de los inputs
        const fechaEdit = fila.querySelector(`#fecha-${index}`).value.trim();
        const clientaEdit = fila.querySelector(`#clienta-${index}`).value.trim();
        const productoEdit = fila.querySelector(`#producto-${index}`).value.trim();
        const bonoEdit = fila.querySelector(`#bono-${index}`).value.trim();
        const puntosEdit = parseInt(fila.querySelector(`#puntos-${index}`).value, 10) || 0;
        const comentarioEdit = fila.querySelector(`#comentario-${index}`).value.trim();

        // Validar los datos
        if (!fechaEdit || !clientaEdit || !productoEdit) {
            alert("Por favor, completa todos los campos obligatorios.");
            return;
        }

        // Actualizar el array `ventas`
        ventas[index] = {
            fecha: fechaEdit,
            clienta: clientaEdit,
            producto: productoEdit,
            bono: bonoEdit || 0, // Si no hay bono, asignar 0
            puntos: puntosEdit,
            comentario: comentarioEdit
        };

        guardarLocalStorage(); // Guardar en LocalStorage

        // Deshabilitar los inputs tras guardar
        fila.querySelectorAll('input').forEach(input => {
            input.disabled = true; // Deshabilitar edici√≥n
        });

        // Alternar visibilidad de botones
        const guardarBoton = fila.querySelector(`button[onclick="guardarEdicion(${index})"]`);
        const editarBoton = fila.querySelector(`button[onclick="editarVenta(${index})"]`);

        if (guardarBoton && editarBoton) {
            guardarBoton.style.display = 'none'; // Ocultar bot√≥n Guardar
            editarBoton.style.display = 'inline'; // Mostrar bot√≥n Editar
        }
    }

    function eliminarVenta(index) {
        const confirmar = confirm("¬øEst√°s seguro de que deseas eliminar esta venta?");
        if (confirmar) {
            ventas.splice(index, 1); // Eliminar la venta del array
            guardarLocalStorage();  // Guardar los cambios en LocalStorage
            mostrarVentas();        // Refrescar la tabla de ventas

            // Actualizar los datos del periodo actual
            actualizarDatosPeriodoActual();
        }
    }


 // ************************* Gesti√≥n de PERIODOS ************************

    function encontrarPeriodo(fechaVenta) {
        const fecha = new Date(fechaVenta);
        const periodoEncontrado = periodos.find(periodo => {
            const inicio = new Date(periodo.inicio);
            const fin = new Date(periodo.fin);
            return fecha >= inicio && fecha <= fin;
        });
        return periodoEncontrado ? periodoEncontrado.nombre : 'No asignado';
    }

    function mostrarPeriodos() {
        const tablaPeriodos = document.getElementById('tablaPeriodos');
        tablaPeriodos.innerHTML = '';

        if (periodos.length === 0) {
            tablaPeriodos.innerHTML = '<tr><td colspan="4" class="text-center py-4">No hay periodos registrados.</td></tr>';
            return;
        }

        periodos.forEach((periodo, index) => {
            tablaPeriodos.innerHTML += `
                <tr>
                    <td class="py-2 px-4 border">
                        <span id="periodoRec-nombre-span-${index}">${periodo.nombre}</span>
                        <input type="text" id="periodoRec-nombre-input-${index}" value="${periodo.nombre}" class="hidden border p-1 w-full">
                    </td>
                    <td class="py-2 px-4 border">
                        <span id="periodoRec-inicio-span-${index}">${periodo.inicio}</span>
                        <input type="date" id="periodoRec-inicio-input-${index}" value="${periodo.inicio}" class="hidden border p-1 w-full">
                    </td>
                    <td class="py-2 px-4 border">
                        <span id="periodoRec-fin-span-${index}">${periodo.fin}</span>
                        <input type="date" id="periodoRec-fin-input-${index}" value="${periodo.fin}" class="hidden border p-1 w-full">
                    </td>
                    <td class="py-2 px-4 border text-center">
                        <button class="icon-button" id="editarPeriodoRec-${index}" onclick="editarPeriodoRec(${index})">‚úèÔ∏è</button>
                        <button class="icon-button hidden" id="guardarPeriodoRec-${index}" onclick="guardarPeriodoRec(${index})">üíæ</button>
                        <button class="icon-button" onclick="eliminarPeriodo(${index})">‚ùå</button>
                    </td>
                </tr>
            `;
        });
    }

    function agregarPeriodo() {
        const nombrePeriodo = document.getElementById('nombrePeriodo').value.trim();
        const fechaInicioPeriodo = document.getElementById('fechaInicioPeriodo').value;
        const fechaFinPeriodo = document.getElementById('fechaFinPeriodo').value;

        if (!nombrePeriodo || !fechaInicioPeriodo || !fechaFinPeriodo) {
            alert("Completa todos los campos del periodo.");
            return;
        }

        periodos.push({ nombre: nombrePeriodo, inicio: fechaInicioPeriodo, fin: fechaFinPeriodo });
        guardarLocalStorage();
        mostrarPeriodos();
          // Actualizar los selectores en la secci√≥n META
        
        cargarPeriodosEnSelector('selectPeriodoActual');
        cargarPeriodosEnSelector('selectPeriodo');

        document.getElementById('nombrePeriodo').value = '';
        document.getElementById('fechaInicioPeriodo').value = '';
        document.getElementById('fechaFinPeriodo').value = '';
    }

    function editarPeriodoRec(index) {
        document.getElementById(`periodoRec-nombre-span-${index}`).classList.add('hidden');
        document.getElementById(`periodoRec-inicio-span-${index}`).classList.add('hidden');
        document.getElementById(`periodoRec-fin-span-${index}`).classList.add('hidden');

        document.getElementById(`periodoRec-nombre-input-${index}`).classList.remove('hidden');
        document.getElementById(`periodoRec-inicio-input-${index}`).classList.remove('hidden');
        document.getElementById(`periodoRec-fin-input-${index}`).classList.remove('hidden');

        document.getElementById(`editarPeriodoRec-${index}`).classList.add('hidden');
        document.getElementById(`guardarPeriodoRec-${index}`).classList.remove('hidden');
    }

    function guardarPeriodoRec(index) {
        const nuevoNombre = document.getElementById(`periodoRec-nombre-input-${index}`).value.trim();
        const nuevaFechaInicio = document.getElementById(`periodoRec-inicio-input-${index}`).value;
        const nuevaFechaFin = document.getElementById(`periodoRec-fin-input-${index}`).value;

        if (!nuevoNombre || !nuevaFechaInicio || !nuevaFechaFin) {
            alert("Completa correctamente todos los campos.");
            return;
        }

        periodos[index] = { nombre: nuevoNombre, inicio: nuevaFechaInicio, fin: nuevaFechaFin };
        guardarLocalStorage();
        mostrarPeriodos();

        cargarPeriodosEnSelector('selectPeriodoActual');
        cargarPeriodosEnSelector('selectPeriodo');
    }

    function eliminarPeriodo(index) {
        const confirmar = confirm("¬øEst√°s seguro de que deseas eliminar este periodo?");
        if (confirmar) {
            periodos.splice(index, 1);
            guardarLocalStorage();
            mostrarPeriodos();
            cargarPeriodosEnSelector('selectPeriodoActual');
            cargarPeriodosEnSelector('selectPeriodo');
        }
    }

    function cargarPeriodosEnSelector(selectorId = 'selectPeriodoActual') {
        const selectPeriodo = document.getElementById(selectorId);
        selectPeriodo.innerHTML = '<option value="">Seleccionar periodo</option>';

        if (periodos.length > 0) {
            const fechaActual = new Date();
            periodos.forEach(periodo => {
                const inicio = new Date(periodo.inicio);
                const fin = new Date(periodo.fin);

                const option = document.createElement('option');
                option.value = periodo.nombre;
                option.textContent = periodo.nombre;

                if (fechaActual >= inicio && fechaActual <= fin) {
                    option.selected = true;
                }

                selectPeriodo.appendChild(option);
            });
        } else {
            console.warn("No hay periodos disponibles.");
        }
    }

    function actualizarDatosPeriodoActual() {
        calcularMetaPeriodoActual();
        calcularProgresoMitadPeriodo();
        calcularDiasRestantes();
        actualizarBarraProgreso();
    }

   // ************************* Gesti√≥n de SOCIAS VE ************************
    function mostrarVentasPorSocia() {
        const tablaPuntos = document.getElementById('tablaPuntos');
        tablaPuntos.innerHTML = ''; // Limpiar la tabla antes de llenarla

        if (puntos.length === 0) {
            tablaPuntos.innerHTML = '<tr><td colspan="4" class="text-center py-4">No hay puntos registrados.</td></tr>';
            return;
        }

        puntos.forEach((punto, index) => {
            tablaPuntos.innerHTML += `
                <tr>
                    <td class="py-2 px-4 border">
                        <span id="socio-span-${index}">${punto.socio}</span>
                        <input type="text" id="socio-input-${index}" value="${punto.socio}" class="hidden border p-1 w-full">
                    </td>
                    <td class="py-2 px-4 border">
                        <span id="periodo-span-${index}">${punto.periodo}</span>
                        <input type="text" id="periodo-input-${index}" value="${punto.periodo}" class="hidden border p-1 w-full">
                    </td>
                    <td class="py-2 px-4 border">
                        <span id="puntosVE-span-${index}">${punto.puntosVE}</span>
                        <input type="number" id="puntosVE-input-${index}" value="${punto.puntosVE}" class="hidden border p-1 w-full">
                    </td>
                    <td class="py-2 px-4 border text-center">
                        <button class="icon-button" id="editarPuntos-${index}" onclick="habilitarEdicionPuntosPorSocia(${index})">‚úèÔ∏è</button>
                        <button class="icon-button hidden" id="guardarPuntos-${index}" onclick="guardarPuntosPorSocia(${index})">üíæ</button>
                        <button class="icon-button" onclick="eliminarPuntosPorSocia(${index})">‚ùå</button>
                    </td>
                </tr>
            `;
        });
    }

    function guardarPuntosPorSocia(index) {
        const nuevoSocio = document.getElementById(`socio-input-${index}`).value.trim();
        const nuevoPeriodo = document.getElementById(`periodo-input-${index}`).value.trim();
        const nuevosPuntosVE = parseInt(document.getElementById(`puntosVE-input-${index}`).value, 10);

        if (!nuevoSocio || !nuevoPeriodo || isNaN(nuevosPuntosVE) || nuevosPuntosVE < 0) {
            alert("Por favor, completa todos los campos correctamente.");
            return;
        }

        // Actualizar el array
        puntos[index] = { socio: nuevoSocio, periodo: nuevoPeriodo, puntosVE: nuevosPuntosVE };
        guardarLocalStorage();

        // Actualizar la interfaz
        mostrarVentasPorSocia(); // Refrescar la tabla tras guardar
    }


    function registrarPuntosPorSocia() {
        const socio = document.getElementById('selectSocio').value.trim();
        const periodo = document.getElementById('selectPeriodo').value.trim(); // Periodo seleccionado
        const puntosVE = parseInt(document.getElementById('puntosVE').value, 10);

        if (!socio || !periodo || isNaN(puntosVE) || puntosVE <= 0) {
            alert("Por favor, selecciona un socio, un periodo y a√±ade puntos VE v√°lidos.");
            return;
        }

        // Verificar si ya existe un registro para el mismo socio y periodo
        const existe = puntos.find(p => p.socio === socio && p.periodo === periodo);
        if (existe) {
            if (confirm("Este socio ya tiene puntos registrados en este periodo. ¬øDeseas actualizar los puntos?")) {
                existe.puntosVE += puntosVE;
            }
        } else {
            puntos.push({ socio, periodo, puntosVE });
        }

        guardarLocalStorage();
        mostrarVentasPorSocia(); // Actualizar la tabla de puntos

         // Actualizar los datos del periodo actual
        actualizarDatosPeriodoActual();
    }


    function habilitarEdicionPuntosPorSocia(index) {
        // Ocultar los spans y mostrar los inputs
        document.getElementById(`socio-span-${index}`).classList.add('hidden');
        document.getElementById(`periodo-span-${index}`).classList.add('hidden');
        document.getElementById(`puntosVE-span-${index}`).classList.add('hidden');

        document.getElementById(`socio-input-${index}`).classList.remove('hidden');
        document.getElementById(`periodo-input-${index}`).classList.remove('hidden');
        document.getElementById(`puntosVE-input-${index}`).classList.remove('hidden');

        // Alternar los botones
        document.getElementById(`editarPuntos-${index}`).classList.add('hidden');
        document.getElementById(`guardarPuntos-${index}`).classList.remove('hidden');
    }

    function guardarVenta(index) {
        const nuevoPeriodo = document.getElementById(`periodo-input-${index}`).value.trim();
        const nuevaFecha = document.getElementById(`fecha-input-${index}`).value.trim();
        const nuevaClienta = document.getElementById(`clienta-input-${index}`).value.trim();
        const nuevoProducto = document.getElementById(`producto-input-${index}`).value.trim();
        const nuevosPuntos = parseInt(document.getElementById(`puntos-input-${index}`).value, 10);
        const nuevoBono = document.getElementById(`bono-input-${index}`).value.trim();
        const nuevoComentario = document.getElementById(`comentario-input-${index}`).value.trim();

        if (!nuevaFecha || !nuevaClienta || !nuevoProducto || isNaN(nuevosPuntos) || nuevosPuntos < 0) {
            alert("Por favor, completa todos los campos correctamente.");
            return;
        }

        ventas[index] = {
            fecha: nuevaFecha,
            clienta: nuevaClienta,
            producto: nuevoProducto,
            bono: nuevoBono,
            puntos: nuevosPuntos,
            comentario: nuevoComentario
        };

        guardarLocalStorage();
        mostrarVentas();

        // Actualizar los datos del periodo actual
        actualizarDatosPeriodoActual();
    }

    function eliminarPuntosPorSocia(index) {
        const confirmar = confirm("¬øEst√°s seguro de que deseas eliminar este registro?");
        if (confirmar) {
            puntos.splice(index, 1); // Eliminar el registro del array
            guardarLocalStorage();
            mostrarVentasPorSocia(); // Actualizar la tabla

            // Actualizar los datos del periodo actual
            actualizarDatosPeriodoActual();
        }
    }

    function actualizarPuntosPorProducto() {
        const productosSeleccionados = Array.from(document.getElementById('selectProductos').selectedOptions).map(option => option.value);
        const contenedor = document.getElementById('puntosPorProductoContainer');
        contenedor.innerHTML = ''; // Limpiar el contenedor antes de a√±adir nuevos inputs

        productosSeleccionados.forEach(productoNombre => {
            // Buscar el producto en el array global "productos"
            const producto = productos.find(p => p.nombre === productoNombre);

            if (producto) {
                const puntosPorDefecto = producto.puntos || 0; // Mostrar puntos predefinidos

                // Crear el input din√°mico con los puntos asociados
                const label = document.createElement('label');
                label.textContent = `Puntos para ${producto.nombre}`;
                label.classList.add('block', 'mb-1');

                const input = document.createElement('input');
                input.type = 'number';
                input.value = puntosPorDefecto; // Rellenar con puntos predefinidos
                input.min = 0;
                input.id = `puntos-${producto.nombre}`;
                input.classList.add('border', 'p-2', 'mb-2', 'w-full', 'rounded-lg');

                contenedor.appendChild(label);
                contenedor.appendChild(input);
            } else {
                console.warn(`Producto no encontrado: ${productoNombre}`);
            }
        });
    }
    document.getElementById('selectProductos').addEventListener('change', actualizarPuntosPorProducto);


   // ************************* Gesti√≥n de SECCI√ìN META ************************

    function calcularPuntosVC(periodoSeleccionado) {
        let totalVC = 0;

        ventas.forEach(venta => {
            const periodoVenta = encontrarPeriodo(venta.fecha);
            if (periodoVenta === periodoSeleccionado) {
                totalVC += venta.puntos;
            }
        });

        return totalVC;
    }

    function calcularMetaPeriodoActual() {
        const periodoSeleccionado = document.getElementById('selectPeriodoActual').value;
        let totalVC = calcularPuntosVC(periodoSeleccionado);
        let totalVE = 0;

        // Recolectar puntos VE del periodo seleccionado
        let puntosVEArray = [];
        puntos.forEach(punto => {
            if (punto.periodo === periodoSeleccionado) {
                puntosVEArray.push(punto.puntosVE);
                totalVE += punto.puntosVE;
            }
        });

        puntosVEArray.sort((a, b) => b - a); // Ordenar VE de mayor a menor para aplicar descuentos

        const metas = [
            { nivel: 1, vc: 110, ve: 0 },
            { nivel: 2, vc: 220, ve: 1000 },
            { nivel: 3, vc: 330, ve: 1600 },
            { nivel: 4, vc: 440, ve: 3200 },
            { nivel: 5, vc: 550, ve: 4000 },
            { nivel: 6, vc: 660, ve: 8000 },
            { nivel: 7, vc: 660, ve: 15000 },
            { nivel: 8, vc: 660, ve: 20000 },
            { nivel: 9, vc: 660, ve: 40000 },
            { nivel: 10, vc: 660, ve: 60000 },
        ];

        // Limitar los puntos VC a 660 para metas m√°s altas
        const VC_LIMIT = 660;
        totalVC = Math.min(totalVC, VC_LIMIT);

        let metaActual = 0;
        let metaSiguiente = null;
        let puntosRestantesVC = 0;
        let puntosRestantesVE = 0;

        for (let i = 0; i < metas.length; i++) {
            const meta = metas[i];
            let totalVEDescuento = totalVE;

            // Aplicar descuentos seg√∫n las reglas de la meta
            if (meta.desc) {
                for (let j = 0; j < Math.min(meta.desc, puntosVEArray.length); j++) {
                    totalVEDescuento -= puntosVEArray[j];
                }
            }

            // Verificar si se alcanza la meta
            if (totalVC >= meta.vc && totalVEDescuento >= meta.ve) {
                metaActual = meta.nivel;
            } else {
                metaSiguiente = meta;
                puntosRestantesVC = Math.max(meta.vc - totalVC, 0);
                puntosRestantesVE = Math.max(meta.ve - totalVEDescuento, 0);
                break;
            }
        }

        // Actualizar la interfaz con los resultados
        document.getElementById('resultadoMeta').textContent = `META ${metaActual} (VC: ${totalVC}, VE: ${totalVE})`;
        document.getElementById('resultadoPuntosRestantes').textContent = metaSiguiente
            ? `Puntos restantes para la siguiente META${metaSiguiente.nivel}: ${puntosRestantesVC} VC y/o ${puntosRestantesVE} VE`
            : '¬°Ya has alcanzado la Meta m√°s alta!';
    }

    function calcularProgresoMitadPeriodo() {
        const periodoSeleccionado = document.getElementById('selectPeriodoActual').value;
        const periodo = periodos.find(p => p.nombre === periodoSeleccionado);

        if (!periodo) {
            document.getElementById('progresoMitadPeriodo').textContent = 'Periodo no encontrado.';
            return;
        }

        const fechaInicio = new Date(periodo.inicio);
        const fechaFin = new Date(periodo.fin);
        const mitadPeriodo = new Date(fechaInicio.getTime() + (fechaFin.getTime() - fechaInicio.getTime()) / 2);

        let totalVC = 0;
        let totalVE = 0;

        ventas.forEach(venta => {
            const fechaVenta = new Date(venta.fecha);
            if (fechaVenta <= mitadPeriodo && encontrarPeriodo(venta.fecha) === periodoSeleccionado) {
                totalVC += venta.puntos;
            }
        });

        puntos.forEach(punto => {
            if (punto.periodo === periodoSeleccionado) {
                totalVE += punto.puntosVE;
            }
        });

        document.getElementById('progresoMitadPeriodo').textContent = `VC conseguidos: ${totalVC} / VE conseguidos: ${totalVE}`;
    }


    function calcularDiasRestantes() {
        const periodoSeleccionado = document.getElementById('selectPeriodoActual').value;
        const periodo = periodos.find(p => p.nombre === periodoSeleccionado);

        if (!periodo) {
            document.getElementById('diasRestantes').textContent = 'Periodo no encontrado.';
            return;
        }

        const fechaInicio = new Date(periodo.inicio);
        const fechaFin = new Date(periodo.fin);
        const hoy = new Date();

        if (hoy < fechaInicio) {
            document.getElementById('diasRestantes').textContent = 
                `El periodo seleccionado a√∫n no ha comenzado. Inicia en ${Math.ceil((fechaInicio - hoy) / (1000 * 60 * 60 * 24))} d√≠as.`;
        } else if (hoy <= fechaFin) {
            document.getElementById('diasRestantes').textContent = 
                `Faltan ${Math.ceil((fechaFin - hoy) / (1000 * 60 * 60 * 24))} d√≠as para finalizar el periodo.`;
        } else {
            document.getElementById('diasRestantes').textContent = 'El periodo ya ha finalizado.';
        }
    }

    function actualizarBarraProgreso() {
    const periodoSeleccionado = document.getElementById('selectPeriodoActual').value;
    let totalVC = calcularPuntosVC(periodoSeleccionado);
    let totalVE = 0;

    puntos.forEach(punto => {
        if (punto.periodo === periodoSeleccionado) {
            totalVE += punto.puntosVE;
        }
    });

    const metas = [
        { nivel: 1, vc: 110, ve: 0 },
        { nivel: 2, vc: 220, ve: 1000 },
        { nivel: 3, vc: 330, ve: 1600 },
        { nivel: 4, vc: 440, ve: 3200 },
        { nivel: 5, vc: 550, ve: 4000 },
        { nivel: 6, vc: 660, ve: 8000 },
        { nivel: 7, vc: 660, ve: 15000 },
        { nivel: 8, vc: 660, ve: 20000 },
        { nivel: 9, vc: 660, ve: 40000 },
        { nivel: 10, vc: 660, ve: 60000 },
    ];

    const VC_LIMIT = 660;
    totalVC = Math.min(totalVC, VC_LIMIT);

    const metaSiguiente = metas.find(meta => (meta.vc + meta.ve) > (totalVC + totalVE));

    const barra = document.getElementById('barraProgreso');
    const textoProgreso = document.getElementById('textoProgreso');

    if (!metaSiguiente) {
        barra.style.width = '100%';
        barra.textContent = '';
        textoProgreso.textContent = '¬°Meta m√°s alta alcanzada!';
        return;
    }

    const puntosTotalesRequeridos = metaSiguiente.vc + metaSiguiente.ve;
    const puntosTotalesActuales = totalVC + totalVE;

    const progresoTotal = Math.min((puntosTotalesActuales / puntosTotalesRequeridos) * 100, 100);

    barra.style.width = `${progresoTotal}%`;

    // Mostrar texto dentro de la barra si hay espacio suficiente
    if (progresoTotal > 15) {
        barra.textContent = `${Math.round(progresoTotal)}%`;
        textoProgreso.textContent = ''; // No se necesita texto fuera
    } else {
        barra.textContent = ''; // No cabe texto dentro de la barra
        textoProgreso.textContent = `${Math.round(progresoTotal)}% completado hacia META ${metaSiguiente.nivel}`;
    }
}

   // ************************* Gesti√≥n de FILTROS Y EXPORTACI√ìN ************************

    function filtrarVentas() {
        const filtroTipo = document.getElementById('filtroTipo').value;
        const filtroAno = document.getElementById('filtroAno')?.value;
        const filtroMes = document.getElementById('filtroMes')?.value;
        const filtroClienta = document.getElementById('filtroClienta')?.value.toLowerCase();
        const filtroProducto = document.getElementById('filtroProducto')?.value.toLowerCase();
        const filtroFechaInicio = document.getElementById('filtroFechaInicio')?.value;
        const filtroFechaFin = document.getElementById('filtroFechaFin')?.value;

        const buscador = document.getElementById('buscadorVentas').value.toLowerCase();

        // Si el buscador tiene texto, no se aplican filtros
        if (buscador) {
            buscarEnTiempoReal();
            return;
        }

        // Aplicar los filtros en funci√≥n del tipo de filtro seleccionado
        const ventasFiltradas = ventas.filter(venta => {
            const fechaVenta = new Date(venta.fecha);
            const anoVenta = fechaVenta.getFullYear();
            const mesVenta = `${fechaVenta.getFullYear()}-${String(fechaVenta.getMonth() + 1).padStart(2, '0')}`;

            return (
                (!filtroTipo || (filtroTipo === 'ano' && anoVenta == filtroAno) ||
                (filtroTipo === 'mes' && mesVenta === filtroMes) ||
                (filtroTipo === 'cliente' && venta.clienta.toLowerCase().includes(filtroClienta)) ||
                (filtroTipo === 'producto' && venta.producto.toLowerCase().includes(filtroProducto)) ||
                (filtroTipo === 'fecha' &&
                    (!filtroFechaInicio || fechaVenta >= new Date(filtroFechaInicio)) &&
                    (!filtroFechaFin || fechaVenta <= new Date(filtroFechaFin))))
            );
        });

        // Actualizar la tabla con los resultados filtrados
        const tablaVentas = document.getElementById('tablaVentas');
        tablaVentas.innerHTML = ''; // Limpiar la tabla antes de actualizar

        if (ventasFiltradas.length === 0) {
            tablaVentas.innerHTML = '<tr><td colspan="7" class="text-center py-4">No se encontraron resultados.</td></tr>';
            return;
        }

        ventasFiltradas.forEach((venta, index) => {
            tablaVentas.innerHTML += `
                <tr>
                    <td class="py-2 px-4 border">${encontrarPeriodo(venta.fecha)}</td>
                    <td class="py-2 px-4 border">${venta.fecha}</td>
                    <td class="py-2 px-4 border">${venta.clienta}</td>
                    <td class="py-2 px-4 border">${venta.producto}</td>
                    <td class="py-2 px-4 border">${venta.puntos}</td>
                    <td class="py-2 px-4 border">${venta.bono || ''}</td>
                    <td class="py-2 px-4 border">${venta.comentario}</td>
                    <td class="py-2 px-4 border text-center">
                        <button class="icon-button" onclick="editarVenta(${index})">‚úèÔ∏è</button>
                        <button class="icon-button" onclick="eliminarVenta(${index})">‚ùå</button>
                    </td>
                </tr>
            `;
        });
    }



    function restaurarFiltros() {
        // Limpia el buscador
        document.getElementById('buscadorVentas').value = '';

        // Limpia el tipo de filtro y los criterios din√°micos
        document.getElementById('filtroTipo').value = '';
        document.getElementById('criteriosFiltro').innerHTML = '';

        // Muestra toda la tabla de ventas
        mostrarVentas();
    }


    function mostrarCriterio() {
        const tipoFiltro = document.getElementById('filtroTipo').value;
        const criterios = document.getElementById('criteriosFiltro');
        criterios.innerHTML = ''; // Limpiar criterios previos

        if (tipoFiltro === 'ano') {
            criterios.innerHTML = `
                <input id="filtroAno" type="number" placeholder="A√±o" class="border p-2 rounded-md w-24 text-center">
            `;
        } else if (tipoFiltro === 'mes') {
            criterios.innerHTML = `
                <input id="filtroMes" type="month" class="border p-2 rounded-md w-36 text-center">
            `;
        } else if (tipoFiltro === 'cliente') {
            criterios.innerHTML = `
                <input id="filtroClienta" type="text" placeholder="Nombre de la clienta" class="border p-2 rounded-md w-48">
            `;
        } else if (tipoFiltro === 'producto') {
            criterios.innerHTML = `
                <input id="filtroProducto" type="text" placeholder="Nombre del producto" class="border p-2 rounded-md w-48">
            `;
        } else if (tipoFiltro === 'fecha') {
            criterios.innerHTML = `
                <input id="filtroFechaInicio" type="date" class="border p-2 rounded-md w-36">
                <input id="filtroFechaFin" type="date" class="border p-2 rounded-md w-36">
            `;
        }
    }



    function ordenarVentas(tipo) {
        ventas.sort((a, b) => {
            const fechaA = new Date(a.fecha);
            const fechaB = new Date(b.fecha);

            return tipo === 'reciente' ? fechaB - fechaA : fechaA - fechaB;
        });

        mostrarVentas(); // Actualiza la tabla con el nuevo orden
    }

    function buscarEnTiempoReal() {
        const buscador = document.getElementById('buscadorVentas').value.toLowerCase();
        const filas = document.querySelectorAll('#tablaVentas tr');

        // Si hay texto en el buscador, prevalece sobre los dem√°s filtros
        if (buscador) {
            // Limpia los filtros din√°micos y el tipo de filtro seleccionado
            document.getElementById('criteriosFiltro').innerHTML = '';
            document.getElementById('filtroTipo').value = '';

            // Filtra las filas de la tabla
            filas.forEach(fila => {
                const textoFila = fila.innerText.toLowerCase();
                fila.style.display = textoFila.includes(buscador) ? '' : 'none';
            });
        } else {
            // Si el buscador est√° vac√≠o, se restauran los filtros aplicados anteriormente
            filtrarVentas();
        }
    }
        //FILTRO PARA CLIENTAS EN REGISTRO DE VENTAS

    document.getElementById('filtrarClientas').addEventListener('input', function() {
        const query = this.value.toLowerCase();
        const select = document.getElementById('selectClientas');
        
        Array.from(select.options).forEach(option => {
            // Si el valor de la opci√≥n incluye el query, se muestra; si no, se oculta
            option.style.display = option.value.toLowerCase().includes(query) ? '' : 'none';
        });
        });

        //FILTRO PARA PRODUCTOS EN REGISTRO DE VENTAS
    document.getElementById('filtrarProductos').addEventListener('input', function() {
            const query = this.value.toLowerCase();
            const select = document.getElementById('selectProductos');

            Array.from(select.options).forEach(option => {
                option.style.display = option.value.toLowerCase().includes(query) ? '' : 'none';
            });
            });

    function exportarDatos() {
            const datos = [
                ['Fecha', 'Clientas', 'Productos', 'Bono', 'Puntos', 'Comentario'],
                ...ventas.map(venta => [venta.fecha, venta.clienta, venta.producto, venta.bono, venta.puntos, venta.comentario])
            ];
            const csvContent = datos.map(e => e.join(",")).join("\n");
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ventas.csv';
            a.click();
            URL.revokeObjectURL(url);
        }

        function importarDatos() {
            const archivo = document.getElementById('importarArchivo').files[0];

            if (!archivo) {
                alert("Por favor, selecciona un archivo CSV para importar.");
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const contenido = e.target.result;
                const filas = contenido.split("\n").slice(1); // Omitir la primera fila (cabecera)

                filas.forEach((fila, index) => {
                    // Separar los valores por comas (u otro delimitador, si es necesario)
                    const [fecha, clienta, producto, bono, puntos, comentario] = fila.split(",");

                    // Validar que los datos necesarios est√°n presentes
                    if (!fecha || !clienta || !producto || !comentario) {
                        console.warn(`Fila ${index + 2}: Datos incompletos. Esta fila ser√° ignorada.`);
                        return; // Ignorar esta fila
                    }

                    // Convertir puntos a n√∫mero entero (manejo seguro si est√° vac√≠o o es NaN)
                    const puntosConvertidos = parseInt(puntos, 10) || 0;

                    // Agregar la venta al array
                    ventas.push({
                        fecha: fecha.trim(),
                        clienta: clienta.trim(),
                        producto: producto.trim(),
                        bono: bono ? bono.trim() : "N/A", // Si el bono est√° vac√≠o, asignar "N/A"
                        puntos: puntosConvertidos,
                        comentario: comentario.trim()
                    });
                });
                guardarLocalStorage(); // Guardar los datos actualizados en localStorage
                mostrarVentas(); // Refrescar la tabla de ventas
                alert("Los datos del archivo han sido importados correctamente.");
            };
            // Leer el contenido del archivo como texto
            reader.readAsText(archivo);
        }


    function guardarCopiaSeguridad() {
        const copiaSeguridad = {
            productos,
            clientas,
            bonos,
            ventas
        };
        const blob = new Blob([JSON.stringify(copiaSeguridad)], { type: 'application/json;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'copia_seguridad.json';
        a.click();
        URL.revokeObjectURL(url);
    }

    function restaurarCopiaSeguridad() {
        const archivo = document.getElementById('cargarCopiaSeguridad').files[0];
        if (archivo) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const contenido = e.target.result;
                const copiaSeguridad = JSON.parse(contenido);
                productos = copiaSeguridad.productos;
                clientas = copiaSeguridad.clientas;
                bonos = copiaSeguridad.bonos;
                ventas = copiaSeguridad.ventas;
                guardarLocalStorage();
                mostrarProductos();
                mostrarClientas();
                mostrarBonos();
                mostrarVentas();
            };
            reader.readAsText(archivo);
        }
    }

    // ************************* Funciones de UTILIDAD ************************

    function toggleProductos() {
        const divProductos = document.getElementById('productos');
        divProductos.classList.toggle('hidden');
        const icono = document.getElementById('icono-productos');
        icono.textContent = icono.textContent === 'üëÅÔ∏è' ? 'üôà' : 'üëÅÔ∏è';
    }

    function toggleClientas() {
        const divClientas = document.getElementById('clientas');
        divClientas.classList.toggle('hidden');
        const icono = document.getElementById('icono-clientas');
        icono.textContent = icono.textContent === 'üëÅÔ∏è' ? 'üôà' : 'üëÅÔ∏è';
    }

    function toggleBonos() {
        const divBonos = document.getElementById('bonos');
        divBonos.classList.toggle('hidden');
        const icono = document.getElementById('icono-bonos');
        icono.textContent = icono.textContent === 'üëÅÔ∏è' ? 'üôà' : 'üëÅÔ∏è';
    }

    function toggleSocios() {
        const divSocios = document.getElementById('socios');
        divSocios.classList.toggle('hidden');
        const icono = document.getElementById('icono-socios');
        icono.textContent = icono.textContent === 'üëÅÔ∏è' ? 'üôà' : 'üëÅÔ∏è';
    }

    function scrollToSection(sectionId) {
        const section = document.getElementById(sectionId);
        if (section) {
            const elementPosition = section.getBoundingClientRect().top; // Posici√≥n del elemento relativo a la ventana
            const offsetPosition = elementPosition + window.pageYOffset - (window.innerHeight / 2) + (section.offsetHeight / 2);
            
            window.scrollTo({
                top: offsetPosition,
                behavior: 'smooth'
            });
        }
    }
    
    function scrollToTop() {
        window.scrollTo({
            top: 0,
            behavior: 'smooth' // Desplazamiento suave
        });
    }

    function guardarLocalStorage() {
        localStorage.setItem('productos', JSON.stringify(productos));
        localStorage.setItem('clientas', JSON.stringify(clientas));
        localStorage.setItem('bonos', JSON.stringify(bonos));
        localStorage.setItem('ventas', JSON.stringify(ventas));
        localStorage.setItem('socios', JSON.stringify(socios));
        localStorage.setItem('puntos', JSON.stringify(puntos));
        localStorage.setItem('periodos', JSON.stringify(periodos));
    }

    function borrarLocalStorage() {
        if (confirm("¬øEst√°s seguro de que deseas borrar todos los datos guardados?")) {
            localStorage.clear();
            alert("Todos los datos han sido borrados.");
            location.reload(); // Opcional: recarga la p√°gina para reflejar los cambios.
        }
    }
    
    document.getElementById('menuButton').addEventListener('click', function () {
        const menuList = document.getElementById('menuList');
        menuList.classList.toggle('hidden');
    });

    function exportarVentasExcel() {
        let datos = `
            <table>
                <tr>
                    <th>Periodo de Facturaci√≥n</th>
                    <th>Fecha</th>
                    <th>Clientas</th>
                    <th>Productos</th>
                    <th>Bono</th>
                    <th>Puntos</th>
                    <th>Comentario</th>
                </tr>
                ${ventas.map(venta => `
                    <tr>
                        <td>${encontrarPeriodo(venta.fecha)}</td>
                        <td>${venta.fecha}</td>
                        <td>${venta.clienta}</td>
                        <td>${venta.producto}</td>
                        <td>${venta.bono}</td>
                        <td>${venta.puntos}</td>
                        <td>${venta.comentario}</td>
                    </tr>
                `).join('')}
            </table>
        `;

        // Crear un archivo Blob con los datos
        const blob = new Blob([datos], { type: 'application/vnd.ms-excel' });
        const url = URL.createObjectURL(blob);

        // Crear un elemento <a> para descargar
        const a = document.createElement('a');
        a.href = url;
        a.download = 'ventas_registradas.xls';
        a.click();

        // Liberar el objeto URL
        URL.revokeObjectURL(url);
    }
    //GOOGLE CALENDAR DEVELPOMENT
    // Funci√≥n para inicializar el cliente de Google API
  function initClient() {
    gapi.client.init({
      apiKey: 'AIzaSyAhpDHrwoFQdhbRjHrC3Jl4HFbmBOgSw0s',            // Reemplaza con tu API key
      clientId: '309599233403-h8r78g25tpul9qdu50u8l396g5bbujas.apps.googleusercontent.com',        // Reemplaza con tu Client ID
      discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"],
      scope: "https://www.googleapis.com/auth/calendar.events"
    }).then(function () {
      console.log("Google API client inicializado");
    }, function(error) {
      console.error("Error al inicializar la API", error);
    });
  }
  
  // Cargar la biblioteca 'client:auth2' y luego llamar a initClient
  gapi.load('client:auth2', initClient);
    
    
    
    function crearEventoGoogleCalendar(titulo, fechaInicio, descripcion) {
  // Configura el objeto evento
  var evento = {
    'summary': titulo,
    'description': descripcion,
    'start': {
      'dateTime': fechaInicio.toISOString(),
      'timeZone': 'America/Mexico_City' // Ajusta la zona horaria seg√∫n corresponda
    },
    'end': {
      'dateTime': new Date(fechaInicio.getTime() + 60*60*1000).toISOString(), // Evento de 1 hora
      'timeZone': 'America/Mexico_City'
    },
    'reminders': {
      'useDefault': true
    }
  };

  var request = gapi.client.calendar.events.insert({
    'calendarId': 'primary',
    'resource': evento
  });

  request.execute(function(eventoCreado) {
    console.log('Evento creado: ' + eventoCreado.htmlLink);
  });
}








    window.onload = function() {
        // 1. Configurar la fecha actual como valor por defecto en el campo de fecha de venta
        const hoy = new Date();
        const dia = String(hoy.getDate()).padStart(2, '0');
        const mes = String(hoy.getMonth() + 1).padStart(2, '0'); // Enero es 0
        const anio = hoy.getFullYear();
        const fechaActual = `${anio}-${mes}-${dia}`;
        document.getElementById('fechaVenta').value = fechaActual;

        // 2. Mostrar las listas iniciales de datos
        mostrarProductos();      // Mostrar la lista de productos
        mostrarClientas();       // Mostrar la lista de clientas
        mostrarBonos();          // Mostrar la lista de bonos
        mostrarVentas();         // Mostrar las ventas registradas
        mostrarSocios();         // Mostrar la lista de socios
        mostrarVentasPorSocia();         // Mostrar los puntos por periodo
        mostrarPeriodos();       // Mostrar los periodos de facturaci√≥n

        // 3. Actualizar los selectores din√°micos
        actualizarSelectProductos();    // Actualizar el selector de productos
        actualizarSelectClientas();     // Actualizar el selector de clientas
        actualizarSelectBonos();        // Actualizar el selector de bonos
        cargarPeriodosEnSelector('selectPeriodoActual'); // Rellenar selector de Periodo Actual
        cargarPeriodosEnSelector('selectPeriodo'); // Rellenar selector en Puntos por Soci@s

        // 4. Inicializar las m√©tricas de la secci√≥n META
        actualizarDatosPeriodoActual(); // Actualizar todos los datos del periodo seleccionado (metas, progreso, d√≠as restantes)

        // 5. Configurar eventos din√°micos
        document.getElementById('selectProductos').addEventListener('change', actualizarPuntosPorProducto);
    };
</script>
</body>

<footer class="bg-gray-200 text-gray-700 p-6 rounded-lg shadow-md mt-8">
    <div class="text-center mb-2">
        <p class="text-lg font-semibold">Todos los derechos reservados</p>
        <p class="text-sm">Propiedad de <span class="font-medium">Juan Carlos Pardo</span></p>
    </div>
    <div class="text-center mt-4 text-xs text-gray-600">
        <p>Desarrollado con üíª y ‚ù§Ô∏è para organizar tus ventas de manera eficiente.</p>
    </div>
</footer>


</html>
